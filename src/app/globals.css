@tailwind base;
@tailwind components;
@tailwind utilities;

/* ═══════════════════════════════════════════════════════════════════════════
   DESIGN SYSTEM TOKENS  — Mission Control v3
   All components consume tokens via CSS custom properties.
   Never hard-code a colour, spacing, or shadow that duplicates a token.
   ═══════════════════════════════════════════════════════════════════════════ */
:root {
  --bg-base:        #F5F0EB;
  --bg-0:           #EDE7E0;
  --bg-1:           #E6DED5;
  --bg-2:           #DDD4C9;
  --surface-1:      rgba(255, 250, 245, 0.92);
  --surface-2:      rgba(240, 232, 222, 0.75);
  --surface-3:      rgba(230, 222, 213, 0.55);
  --surface-hover:  rgba(210, 195, 178, 0.40);
  --glass:          rgba(255, 250, 245, 0.88);
  --glass-soft:     rgba(245, 240, 235, 0.65);
  --border:         rgba(139, 109, 82, 0.15);
  --border-subtle:  rgba(139, 109, 82, 0.08);
  --border-strong:  rgba(139, 109, 82, 0.25);
  --text-primary:   #3D2B1F;
  --text-secondary: #7A6555;
  --text-muted:     #A89585;
  --text-faint:     #C4B5A5;
  --text-main:      #3D2B1F;
  --text-2xs: 0.6875rem;
  --text-xs:  0.75rem;
  --text-sm:  0.8125rem;
  --text-base:0.9375rem;
  --text-lg:  1.125rem;
  --text-xl:  1.375rem;
  --text-2xl: 1.625rem;
  --text-3xl: 1.875rem;
  --sp-1: 0.25rem; --sp-2: 0.5rem; --sp-3: 0.75rem; --sp-4: 1rem;
  --sp-5: 1.25rem; --sp-6: 1.5rem; --sp-8: 2rem; --sp-10: 2.5rem;
  --shadow-xs:  0 1px 2px rgba(90,60,30,0.06);
  --shadow-sm:  0 2px 8px rgba(90,60,30,0.08);
  --shadow-md:  0 4px 16px rgba(90,60,30,0.10);
  --shadow-lg:  0 8px 32px rgba(90,60,30,0.12);
  --shadow-xl:  0 16px 48px rgba(90,60,30,0.15);
  --shadow-panel: 0 6px 32px rgba(90,60,30,0.08);
  --radius-sm: 0.375rem; --radius-md: 0.5rem; --radius-lg: 0.75rem; --radius-xl: 1rem;
  --status-ok-text:    #2D7A4A;
  --status-ok-bg:      rgba(45,122,74,0.10);
  --status-ok-border:  rgba(45,122,74,0.25);
  --status-warn-text:  #B07D2E;
  --status-warn-bg:    rgba(176,125,46,0.10);
  --status-warn-border:rgba(176,125,46,0.25);
  --status-crit-text:  #C44040;
  --status-crit-bg:    rgba(196,64,64,0.08);
  --status-crit-border:rgba(196,64,64,0.22);
  --status-info-text:  #2B7A8E;
  --status-info-bg:    rgba(43,122,142,0.10);
  --status-info-border:rgba(43,122,142,0.25);
  --status-idle-text:  #8B7A6A;
  --status-idle-bg:    rgba(139,122,106,0.10);
  --status-idle-border:rgba(139,122,106,0.20);
  --alex-start: #C68A3C; --alex-end: #A0722E;
  --sam-start:  #2B7A8E; --sam-end:  #1E6070;
  --lyra-start: #7B5EA7; --lyra-end: #624A8A;
  --nova-start: #C44040; --nova-end: #A03333;
  --topnav-h:      56px;
  --command-bar-h: 56px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   RESET
   ═══════════════════════════════════════════════════════════════════════════ */
*, *::before, *::after { box-sizing: border-box; }

/* Full-height root for scroll isolation */
html, body {
  height: 100%;
  overflow: hidden;
}

body {
  margin: 0;
  color: var(--text-primary);
  font-family: "Inter", "Sora", "Avenir Next", "Segoe UI", system-ui, sans-serif;
  -webkit-font-smoothing: antialiased;
  background: var(--bg-base);
}

a { color: inherit; text-decoration: none; }

/* ═══════════════════════════════════════════════════════════════════════════
   SCROLLBAR
   ═══════════════════════════════════════════════════════════════════════════ */
::-webkit-scrollbar              { width: 4px; height: 4px; }
::-webkit-scrollbar-track        { background: transparent; }
::-webkit-scrollbar-thumb        { background: rgba(139, 109, 82, 0.18); border-radius: 99px; }
::-webkit-scrollbar-thumb:hover  { background: rgba(139, 109, 82, 0.28); }

/* ═══════════════════════════════════════════════════════════════════════════
   COMPONENT LAYER
   ═══════════════════════════════════════════════════════════════════════════ */
@layer components {

  /* ── App Shell ─────────────────────────────────────────────── */
  /* Scroll isolation: app-shell is the full-viewport flex container */
  .app-shell {
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
  }

  /* Command bar spacer — main content scrolls independently */
  .content-wrap {
    flex: 1;
    min-height: 0;
    overflow-y: auto;
    overflow-x: hidden;
    padding: var(--sp-5) var(--sp-5) var(--sp-8);
    padding-top: var(--sp-5);
  }

  /* ── Scroll isolation utilities ─────────────────────────────── */
  /* Use these on any container that should scroll independently */
  .scroll-isolated {
    flex: 1;
    min-height: 0;
    overflow-y: auto;
    overflow-x: hidden;
  }
  .scroll-parent {
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* ── Sticky Command Bar ────────────────────────────────────── */
  .command-bar {
    @apply sticky top-0 z-30 flex items-center gap-3 backdrop-blur-2xl;
    height: var(--command-bar-h);
    background: rgba(255, 250, 245, 0.92);
    border-bottom: 1px solid var(--border);
    padding: 0 var(--sp-5);
  }

  /* ── Panels / Surfaces ─────────────────────────────────────── */
  .panel-glass {
    @apply rounded-xl backdrop-blur-2xl;
    border: 1px solid var(--border);
    background: var(--surface-1);
    box-shadow: var(--shadow-panel);
  }

  .panel-soft {
    @apply rounded-lg border backdrop-blur-md transition-all duration-150;
    border-color: var(--border);
    background: var(--surface-2);
  }

  .panel-soft-interactive {
    @apply panel-soft cursor-pointer;
    border-color: var(--border);
  }
  .panel-soft-interactive:hover {
    border-color: var(--border-strong);
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm);
  }

  /* Elevated tile — for metric cards, KPI blocks */
  .panel-tile {
    @apply rounded-xl border backdrop-blur-xl transition-all duration-200;
    background: linear-gradient(135deg, var(--surface-1) 0%, var(--surface-2) 100%);
    border-color: var(--border);
    box-shadow: var(--shadow-sm);
  }
  .panel-tile:hover {
    border-color: var(--border-strong);
    box-shadow: var(--shadow-md);
  }

  /* ── Inputs ─────────────────────────────────────────────────── */
  .input-glass {
    @apply w-full rounded-lg border px-3 py-2 text-sm placeholder:text-slate-500
           outline-none transition disabled:cursor-not-allowed disabled:opacity-50;
    background: rgba(255, 252, 248, 0.80);
    border-color: var(--border);
    color: var(--text-primary);
  }
  .input-glass:focus {
    border-color: rgba(139, 109, 82, 0.45);
    box-shadow: 0 0 0 3px rgba(139, 109, 82, 0.12);
  }

  /* ── Buttons ─────────────────────────────────────────────────── */
  .btn-primary {
    @apply inline-flex items-center gap-1.5 rounded-lg px-4 py-2 text-sm font-semibold
           text-white transition duration-200 active:scale-[0.97]
           disabled:cursor-not-allowed disabled:opacity-50;
    background: linear-gradient(135deg, #8B6D52 0%, #6B4F3A 100%);
    border: 1px solid rgba(139, 109, 82, 0.35);
    box-shadow: 0 0 20px rgba(139, 109, 82, 0.15);
  }
  .btn-primary:hover:not(:disabled) {
    box-shadow: 0 0 28px rgba(139, 109, 82, 0.25);
    filter: brightness(1.08);
  }

  .btn-secondary {
    @apply inline-flex items-center gap-1.5 rounded-lg border px-4 py-2 text-sm
           font-medium text-slate-200 transition duration-150 active:scale-[0.97];
    background: rgba(230, 222, 213, 0.70);
    border-color: var(--border);
  }
  .btn-secondary:hover {
    border-color: rgba(139, 109, 82, 0.28);
    background: rgba(230, 222, 213, 0.90);
  }

  .btn-ghost {
    @apply inline-flex items-center gap-1 rounded-md px-2 py-1 text-xs
           text-slate-400 transition active:scale-[0.97];
  }
  .btn-ghost:hover { color: var(--text-primary); background: var(--surface-hover); }

  .btn-danger {
    @apply inline-flex items-center rounded-lg px-3 py-1.5 text-xs font-semibold transition active:scale-[0.97];
    color: #fca5a5;
    background: var(--status-crit-bg);
    border: 1px solid var(--status-crit-border);
  }
  .btn-danger:hover { background: rgba(239,68,68,0.22); }

  /* ── Icon Button (square, 36px minimum) ─────────────────────── */
  .btn-icon {
    @apply inline-flex items-center justify-center rounded-lg border transition;
    min-width: 36px; min-height: 36px;
    border-color: var(--border);
    background: var(--surface-2);
    color: var(--text-muted);
  }
  .btn-icon:hover { border-color: var(--border-strong); color: var(--text-primary); }

  /* ── Nav ─────────────────────────────────────────────────────── */
  .nav-link { @apply relative overflow-hidden; }

  /* ── Page Structure ──────────────────────────────────────────── */
  .page-header {
    @apply mb-5 flex flex-wrap items-end justify-between gap-3;
  }
  .page-title {
    @apply m-0 text-xl font-bold tracking-tight;
    color: var(--text-primary);
  }
  .page-subtitle {
    @apply m-0 text-xs;
    color: var(--text-muted);
  }

  /* ── Section Label ───────────────────────────────────────────── */
  .section-label {
    @apply text-[11px] font-bold uppercase tracking-widest;
    color: var(--text-muted);
    letter-spacing: 0.1em;
  }

  /* ── Divider ─────────────────────────────────────────────────── */
  .divider { @apply border-t; border-color: var(--border); }
  .divider-subtle { @apply border-t; border-color: var(--border-subtle); }

  /* ── Badges ──────────────────────────────────────────────────── */
  .badge {
    @apply inline-flex items-center rounded-md border px-2 py-0.5 text-xs font-semibold;
  }
  .badge-alex   { @apply border-amber-600/25  bg-amber-500/10  text-amber-800;   }
  .badge-sam    { @apply border-teal-600/25   bg-teal-500/10   text-teal-800;    }
  .badge-me     { @apply border-stone-500/25  bg-stone-400/10  text-stone-800;   }
  .badge-lyra   { @apply border-purple-600/25 bg-purple-500/10 text-purple-800;  }
  .badge-nova   { @apply border-red-600/25    bg-red-500/10    text-red-800;     }
  .badge-legacy { @apply border-stone-400/20  bg-stone-300/15  text-stone-600;   }

  /* Status badges using token palette */
  .badge-ok     { border-color: var(--status-ok-border);   background: var(--status-ok-bg);   color: var(--status-ok-text);   }
  .badge-warn   { border-color: var(--status-warn-border); background: var(--status-warn-bg); color: var(--status-warn-text); }
  .badge-crit   { border-color: var(--status-crit-border); background: var(--status-crit-bg); color: var(--status-crit-text); }
  .badge-info   { border-color: var(--status-info-border); background: var(--status-info-bg); color: var(--status-info-text); }
  .badge-idle   { border-color: var(--status-idle-border); background: var(--status-idle-bg); color: var(--status-idle-text); }

  /* ── Metric Tile ─────────────────────────────────────────────── */
  .metric-tile {
    @apply panel-tile p-3 flex flex-col gap-1 min-w-0;
  }
  .metric-tile__label {
    @apply text-[10px] uppercase tracking-widest font-semibold truncate;
    color: var(--text-muted);
    letter-spacing: 0.08em;
  }
  .metric-tile__value {
    @apply text-xl font-bold tabular-nums leading-tight;
    color: var(--text-primary);
  }
  .metric-tile__sub {
    @apply text-[10px] font-medium;
    color: var(--text-muted);
  }

  /* Accent left-border variants */
  .metric-tile--ok     { border-left: 2px solid #10b981; }
  .metric-tile--warn   { border-left: 2px solid #f59e0b; }
  .metric-tile--crit   { border-left: 2px solid #ef4444; }
  .metric-tile--info   { border-left: 2px solid #06b6d4; }
  .metric-tile--violet { border-left: 2px solid #8b5cf6; }

  /* ── Data Table ──────────────────────────────────────────────── */
  .data-table        { @apply w-full border-collapse text-sm; }
  .data-table thead tr { @apply border-b; border-color: var(--border); }
  .data-table th {
    @apply text-left py-2 px-3 font-semibold text-[11px] uppercase tracking-wider;
    color: var(--text-muted);
  }
  .data-table tbody tr {
    @apply border-b transition-colors;
    border-color: var(--border-subtle);
  }
  .data-table tbody tr:last-child { @apply border-0; }
  .data-table tbody tr:hover { background: var(--surface-hover); }
  .data-table td { @apply py-2.5 px-3; color: var(--text-primary); }
  .data-table td.muted { color: var(--text-muted); }
  .data-table td.mono  { @apply font-mono text-xs; color: var(--text-secondary); }

  /* ── Compact table (tasks list mode) ────────────────────────── */
  .data-table--compact th { @apply py-1.5 px-2; }
  .data-table--compact td { @apply py-1.5 px-2 text-xs; }

  /* ── Table: keep legacy th/td defaults for non-data-table usage ── */
  table { @apply w-full border-collapse; }
  th {
    @apply text-left text-[11px] uppercase tracking-wider font-semibold pb-2 px-2;
    color: var(--text-muted);
    border-bottom: 1px solid var(--border);
  }
  td { @apply py-2.5 px-2 text-sm; border-top: 1px solid var(--border-subtle); }

  /* ── Loading shimmer ─────────────────────────────────────────── */
  @keyframes shimmer {
    0%   { background-position: -200% 0; }
    100% { background-position:  200% 0; }
  }
  .animate-shimmer {
    background: linear-gradient(
      90deg,
      rgba(255,255,255,0)    0%,
      rgba(139, 109, 82, 0.06) 50%,
      rgba(255,255,255,0)    100%
    );
    background-size: 200% 100%;
    animation: shimmer 1.8s infinite;
  }

  /* ── Status pulse ────────────────────────────────────────────── */
  @keyframes statusPulse {
    0%, 100% { opacity: 1;   }
    50%      { opacity: 0.45; }
  }
  .status-pulse { animation: statusPulse 2.5s ease-in-out infinite; }

  /* ── Slide-in page enter ─────────────────────────────────────── */
  @keyframes pageEnter {
    from { opacity: 0; transform: translateY(8px); }
    to   { opacity: 1; transform: translateY(0);   }
  }
  .page-enter { animation: pageEnter 0.24s ease-out; }

  /* ── Fade in ─────────────────────────────────────────────────── */
  @keyframes fadeIn {
    from { opacity: 0; }
    to   { opacity: 1; }
  }
  .fade-in { animation: fadeIn 0.18s ease-out; }

  /* ── Focus Accessibility ─────────────────────────────────────── */
  /* Crisp keyboard-nav rings using actual page bg colour */
  a:focus-visible, button:focus-visible, [role="button"]:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px var(--bg-0), 0 0 0 4px rgba(139, 109, 82, 0.75);
    border-radius: var(--radius-sm);
  }
  input:focus-visible, textarea:focus-visible, select:focus-visible {
    outline: none;
    box-shadow: 0 0 0 1px var(--bg-0), 0 0 0 3px rgba(139, 109, 82, 0.50);
  }

  /* ── Skeleton ────────────────────────────────────────────────── */
  .skeleton {
    @apply rounded animate-pulse;
    background: rgba(139, 109, 82, 0.08);
  }
}

/* ═══════════════════════════════════════════════════════════════════════════
   RESPONSIVE BREAKPOINTS
   ═══════════════════════════════════════════════════════════════════════════ */

/* ── ≤768px : Mobile ──────────────────────────────────────── */
@media (max-width: 768px) {
  .content-wrap { padding: var(--sp-4) var(--sp-3) var(--sp-5) !important; }
}

/* ── ≤480px : Extra small ────────────────────────────────── */
@media (max-width: 480px) {
  /* All interactive elements: no 300ms tap delay */
  button, a, select, input { touch-action: manipulation; }

  .app-shell   { overflow-x: hidden; }
  .content-wrap {
    padding: var(--sp-3) var(--sp-3) var(--sp-5) !important;
    overflow-x: hidden;
    min-width: 0;
  }
  .panel-soft,
  .panel-glass,
  .panel-tile { max-width: 100%; overflow-x: hidden; word-wrap: break-word; }
  /* Prevent iOS zoom on text inputs */
  .input-glass { font-size: 16px !important; }
  .page-title  { font-size: var(--text-xl) !important; }
  .metric-tile__value { font-size: var(--text-lg) !important; }
  /* Clamp dynamic max-heights on short viewports */
  .max-h-screen-clamped { max-height: max(200px, calc(100vh - 300px)); }
}

/* ── ≤920px : Kanban collapses to 1-col ──────────────────── */
@media (max-width: 920px) {
  .kanban-grid   { grid-template-columns: 1fr !important; }
  .task-form-row { flex-direction: column !important; align-items: stretch !important; }
}

/* ── 481–1024px : 2-col kanban ───────────────────────────── */
@media (min-width: 481px) and (max-width: 1024px) {
  .kanban-grid { grid-template-columns: repeat(2, 1fr) !important; }
}

/* ── Prevent horizontal scroll site-wide ─────────────────── */
.content-wrap { overflow-x: hidden; }

/* ═══════════════════════════════════════════════════════════════════════════
   COMMAND BAR TITLE (inside .command-bar, injected per-page)
   ═══════════════════════════════════════════════════════════════════════════ */
.command-bar__title {
  font-size: var(--text-base);
  font-weight: 600;
  color: var(--text-primary);
  letter-spacing: -0.01em;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.command-bar__subtitle {
  font-size: var(--text-2xs);
  color: var(--text-muted);
  white-space: nowrap;
}

/* ── Top Navigation ── */
.topnav {
  position: sticky; top: 0; z-index: 30;
  display: flex; align-items: center; gap: var(--sp-3);
  height: var(--topnav-h);
  background: rgba(255, 250, 245, 0.92);
  border-bottom: 1px solid var(--border);
  padding: 0 var(--sp-5);
  backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
}
.topnav__tabs { display: flex; align-items: center; gap: var(--sp-1); }
.topnav__tab {
  display: flex; align-items: center; justify-content: center;
  width: 40px; height: 36px; border-radius: var(--radius-md);
  border: 1px solid transparent; color: var(--text-muted);
  font-size: var(--text-base); transition: all 0.15s ease;
  cursor: pointer; text-decoration: none;
}
.topnav__tab:hover {
  color: var(--text-primary); background: var(--surface-hover); border-color: var(--border);
}
.topnav__tab--active {
  color: var(--text-primary); background: var(--surface-1);
  border-color: var(--border-strong); box-shadow: var(--shadow-xs); font-weight: 600;
}

/* ── Bento Grid ── */
.bento-grid {
  display: grid; gap: var(--sp-3);
  grid-template-columns: repeat(12, 1fr);
}
.bento-hero    { grid-column: span 12; }
.bento-wide    { grid-column: span 8; }
.bento-narrow  { grid-column: span 4; }
.bento-half    { grid-column: span 6; }
.bento-third   { grid-column: span 4; }
.bento-quarter { grid-column: span 3; }
.bento-full    { grid-column: span 12; }

@media (max-width: 1024px) {
  .bento-wide, .bento-narrow { grid-column: span 6; }
  .bento-third { grid-column: span 4; }
  .bento-quarter { grid-column: span 6; }
}
@media (max-width: 768px) {
  .bento-grid { grid-template-columns: 1fr; }
  .bento-hero, .bento-wide, .bento-narrow, .bento-half,
  .bento-third, .bento-quarter, .bento-full { grid-column: span 1; }
  .topnav { padding: 0 var(--sp-3); }
  .topnav__tabs { overflow-x: auto; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
  .topnav__tabs::-webkit-scrollbar { display: none; }
}

/* ── Status Hero ── */
.status-hero {
  display: flex; align-items: center; gap: var(--sp-5);
  padding: var(--sp-5) var(--sp-6);
  border-radius: var(--radius-xl);
  border: 1px solid var(--border);
  background: var(--surface-1);
  box-shadow: var(--shadow-sm);
}
.status-hero__indicator {
  width: 48px; height: 48px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.5rem; font-weight: 700; flex-shrink: 0;
  transition: all 0.3s ease;
}
.status-hero--ok .status-hero__indicator {
  background: rgba(45, 122, 74, 0.12); color: var(--status-ok-text);
  box-shadow: 0 0 20px rgba(45, 122, 74, 0.15);
}
.status-hero--warn .status-hero__indicator {
  background: rgba(176, 125, 46, 0.12); color: var(--status-warn-text);
  box-shadow: 0 0 20px rgba(176, 125, 46, 0.15);
}
.status-hero--crit .status-hero__indicator {
  background: rgba(196, 64, 64, 0.10); color: var(--status-crit-text);
  box-shadow: 0 0 20px rgba(196, 64, 64, 0.15);
}

/* ── Staggered page enter animations ── */
@keyframes bentoEnter {
  from { opacity: 0; transform: translateY(12px); }
  to   { opacity: 1; transform: translateY(0); }
}
.bento-animate > * {
  animation: bentoEnter 0.35s ease-out both;
}
.bento-animate > *:nth-child(1) { animation-delay: 0.00s; }
.bento-animate > *:nth-child(2) { animation-delay: 0.04s; }
.bento-animate > *:nth-child(3) { animation-delay: 0.08s; }
.bento-animate > *:nth-child(4) { animation-delay: 0.12s; }
.bento-animate > *:nth-child(5) { animation-delay: 0.16s; }
.bento-animate > *:nth-child(6) { animation-delay: 0.20s; }
.bento-animate > *:nth-child(7) { animation-delay: 0.24s; }
.bento-animate > *:nth-child(8) { animation-delay: 0.28s; }
.bento-animate > *:nth-child(9) { animation-delay: 0.32s; }
.bento-animate > *:nth-child(10) { animation-delay: 0.36s; }

/* ── Metric count-up animation ── */
@keyframes countUp { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
.metric-animate { animation: countUp 0.3s ease-out; }
